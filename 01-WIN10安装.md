# 安装 Windows10

## 1. 安装 winget

- 官方网址

  https://learn.microsoft.com/zh-cn/windows/package-manager/winget/

  ```powershell
  $progressPreference = 'silentlyContinue'
  Write-Information "Downloading WinGet and its dependencies..."
  Invoke-WebRequest -Uri https://aka.ms/getwinget -OutFile Microsoft.DesktopAppInstaller_8wekyb3d8bbwe.msixbundle
  Invoke-WebRequest -Uri https://aka.ms/Microsoft.VCLibs.x64.14.00.Desktop.appx -OutFile Microsoft.VCLibs.x64.14.00.Desktop.appx
  Invoke-WebRequest -Uri https://github.com/microsoft/microsoft-ui-xaml/releases/download/v2.8.6/Microsoft.UI.Xaml.2.8.x64.appx -OutFile Microsoft.UI.Xaml.2.8.x64.appx
  Add-AppxPackage Microsoft.VCLibs.x64.14.00.Desktop.appx
  Add-AppxPackage Microsoft.UI.Xaml.2.8.x64.appx
  Add-AppxPackage Microsoft.DesktopAppInstaller_8wekyb3d8bbwe.msixbundle
  ```

  ※ Windows11 开始，winget 已经属于内嵌在系统内，无需主动安装。

## 2. 清除系统更新的下载

系统更新的时候，有些数据会被下载到 `C:\Windows\SoftwareDistribution` 目录内, 不管是正确安装结束，还是安装错误，都可能需要删除该目录内的数据。

- 删除指令（批处理）

  ```powershell
  net stop wuauserv
  net stop cryptSvc
  net stop bits
  net stop msiserver
  ren C:\Windows\SoftwareDistribution SoftwareDistribution.old
  ren C:\Windows\System32\catroot2 Catroot2.old
  net start wuauserv
  net start cryptSvc
  net start bits
  net start msiserver
  ```

假设是系统更新失败，需要重新下载更新，但是依然失败的话，尝试如下系统维护工具命令：

- 运行 System File Checker (SFC) 工具，输入命令：

  ```powershell
  sfc /scannow
  ```

- 运行 Deployment Image Servicing and Management (DISM) 工具，输入以下命令：

  ```powershell
  DISM /Online /Cleanup-Image /RestoreHealth
  ```

依然无法更新成功的话，清除 C 盘的 `磁盘清理` 功能，包括系统文件也要清理。

## 3. 安装 PowerShell

cmd 是 `command line` 的缩写，意为 ”命令行“，是命令执行窗口。  
启动方式 win+R 输入 cmd 回车启动。

`PowerShell` 和 `Window Terminal` 都是针对 cmd 的扩展，除了可以在 Windows 上是使用，在其它 Linux\Mac类的 OS 上，也可以使用。

### 3.1 PowerShell

- 简介

  PowerShell（包括Windows PowerShell和PowerShell Core）是微软公司开发的任务自动化和配置管理框架。可以理解为 cmd 的升级版，或者说是其超集，类似 Linux 系统的 bash 一样，都是基于壳程序 shell 。

  PowerShell 兼容原来的 cmd 使用的命令格式，且支持命令统一使用cmdlet命令格式（动词-名词），例如 get-help 查看帮助，get-command 查看命令等

  启动方式 在文件夹空白位置 shift+右键 在右键菜单有打开 PowerShell 。

`PowerShell` 除了可以用在 Windows 上，其它各种 Linux 系统也都可以用，如果熟悉了 `PowerShell` 的话，建议在各种系统上都应用该工具。

- 在 Github 上有 `PowerShell` 的最新代码，下载安装即可。

  https://github.com/PowerShell/PowerShell/releases/tag/v7.4.4

  `7.4.4` 的所有版本列表，注意下载最新版本。

### 3.2 Window Terminal

- 是微软在Build 2019大会上发布的面向 Windows10 的新命令行程序，Terminal 集成了 Windows 上的 PowerShell、cmd、Windows Linux子系统（WSL）三大环境

  安装方式 可在微软商店搜索安装。

  在macOS中搜索 终端.app或 Terminal.app 以使用。

## 4. 硬盘瘦身批处理

- 自动批处理

  ```powershell
  dir %WINDIR%\prefetch
  rmdir %WINDIR%\prefetch /s /q
  
  :: 删除Windows目录下面的所有Log文件
  dir %WINDIR%\*.log
  del %WINDIR%\*.log
  
  dir %WINDIR%\temp\*.log
  rmdir %WINDIR%\temp /s /q
  
  dir %WINDIR%\temp\SoftwareDistribution\Download
  rmdir %WINDIR%\temp\SoftwareDistribution\Download /s /q
  
  dir %WINDIR%\SoftwareDistribution\DataStore\Logs\*.log
  del %WINDIR%\SoftwareDistribution\DataStore\Logs\*.log /f
  
  dir %UserProfile%\AppData\Local\Temp
  rmdir %UserProfile%\AppData\Local\Temp /s /q
  
  :: 删除Windows更新库文件
  net stop wuauserv
  del %windir%\softwaredistribution\datastore\datastore.edb
  net start wuauserv
  
  ```

- 删除垃圾文件

  ```powershell
  @echo off
  echo 正在清除系统垃圾文件，请稍等......
  
  net stop wuauserv
  net stop cryptSvc
  net stop bits
  net stop msiserver
  del /f /s /q %systemdrive%\*.tmp
  del /f /s /q %systemdrive%\*._mp
  del /f /s /q %systemdrive%\*.log
  del /f /s /q %systemdrive%\*.gid
  del /f /s /q %systemdrive%\*.chk
  del /f /s /q %systemdrive%\*.old
  del /f /s /q %windir%\*.bak
  del /f /s /q %windir%\prefetch\*.*
  del /f /s /q %windir%\temp\*.*
  del /f /s /q %windir%\SoftwareDistribution\DataStore\*.*
  del /f /s /q %windir%\SoftwareDistribution\Download\*.*
  
  rd  /s /q %windir%\SoftwareDistribution\DataStore & md %windir%\SoftwareDistribution\DataStore
  rd  /s /q %windir%\SoftwareDistribution\Download & md %windir%\SoftwareDistribution\Download
  rd  /s /q %windir%\temp & md %windir%\temp
  
  del /f /s /q "%userprofile%\AppData\Local\Temp\*.*"
  del /f /s /q "%userprofile%\Local Settings\Temporary Internet Files\*.*"
  del /f /s /q "%userprofile%\Local Settings\Temp\*.*"
  
  Net Start WUAUSERV
  net start cryptSvc
  net start bits
  net start msiserver
  echo 清除系统垃圾完成！
  echo. & pause
  
  ```

  