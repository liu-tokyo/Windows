# 文件拷贝指令

## 1. XCOPY

在 `命令提示符` 中执行。  
**注意：** 尽管 XCOPY 功能强大，但对于大规模或需要高可靠性的备份任务，建议使用更专业的工具如 **Robocopy**（Windows 推荐的命令行复制工具），它提供更好的网络容错、日志记录和镜像同步功能。

### 1.1 完整备份示例

```powershell
XCOPY "C:\MyData" "D:\Backup\MyData_Backup" /E /H /K /I /Y
```

**`/S`**: 复制目录和子目录，但**不包括空目录**。

**`/E`**: 复制目录和子目录，**包括空目录**。通常，当您想确保完整复制目录结构时，会使用此参数。

**`/I`**: 如果目标不存在且您要复制多个文件或目录，则假定目标是一个目录。

**`/H`**: 复制**隐藏**和**系统文件**。

**`/K`**: 复制属性。一般的 `COPY` 命令会重置只读属性。

**`/Y`**: 禁止显示覆盖现有文件的提示。

### 1.2 增量备份示例

```powershell
XCOPY "C:\MyData" "D:\Backup\MyData_Backup" /E /H /K /I /M /Y /D
```

**`/D`**: 只复制源日期比目标日期新的文件。

**`/M`**: 只复制具有**存档属性**的文件，并在复制后**清除存档属性**（这是传统的增量备份标记方法）。

## 2. PowerShell

在 **PowerShell** 中，用于递归**拷贝全部文件及子目录**的指令是 `Copy-Item` 配合 **`-Recurse`** 参数。

### 基本指令格式

```powershell
Copy-Item -Path <源文件夹路径> -Destination <目标文件夹路径> -Recurse
```

- **`Copy-Item`**: PowerShell 中用于复制文件、文件夹、注册表项等“项”（Item）的 Cmdlet。
- **`-Path`**: 指定要复制的源文件夹。
- **`-Destination`**: 指定要复制到的目标文件夹。
- **`-Recurse`**: **关键参数**，告诉 `Copy-Item` 递归地复制源文件夹中的所有子目录及其内容。



### 示例与常用选项

以下是两种常见的复制方式及其示例：

#### 1. 复制**整个源文件夹**到目标位置

这会创建一个包含源文件夹名称的新文件夹在目标位置。

```powershell
# 将 C:\SourceFolder 整个文件夹（及其所有内容）复制到 D:\Backup 文件夹下
Copy-Item -Path C:\SourceFolder -Destination D:\Backup -Recurse
# 结果：D:\Backup\SourceFolder\ (包含所有文件和子目录)
```

#### 2. 仅复制**源文件夹中的内容**到目标文件夹

如果您只想复制源文件夹里面的文件和子目录，而不是复制源文件夹本身，需要在 `-Path` 后加上通配符 `\*`。

PowerShell

```powershell
# 将 C:\SourceFolder 内部的所有内容（文件和子目录）复制到 D:\Backup 文件夹中
Copy-Item -Path C:\SourceFolder\* -Destination D:\Backup -Recurse
# 结果：D:\Backup\ (直接包含 C:\SourceFolder 内部的所有文件和子目录)
```

#### 💡 增强选项

在复制时，您可能还会用到以下参数：

- **`-Force`**: 强制执行操作。如果目标文件已存在，使用此参数可以**覆盖**它们。
- **`-Container`**: 复制文件夹本身及其内容（这是默认行为，但有时显式指定有助于理解）。

**带强制覆盖的完整示例：**

```powershell
Copy-Item -Path C:\SourceFolder -Destination D:\Backup -Recurse -Force
```

------

### 替代方法：Robocopy

虽然 `Copy-Item -Recurse` 是 PowerShell 的原生方法，但如果您需要更高级的复制功能（例如：速度优化、跳过特定文件、镜像同步、更好的错误处理），可以使用 Windows 自带的命令行工具 **Robocopy**，它在 PowerShell 中也能运行：

```powershell
robocopy "C:\SourceFolder" "D:\Backup" /E /TEE
# /E: 复制子目录，包括空目录 (相当于 Copy-Item -Recurse)
# /TEE: 在命令行窗口和日志文件上输出（可选）
```